---
title: "Assignment #10"
author: "Cho Kim MSDS 6303-401"
date: "March 21, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Background: Your organization is responsible for building new VA hospitals in the mainland of the United States. You are a little overwhelmed by the prospect, not sure which places need the most help. You decide to begin by exploring healthcare facility data recorded by the U.S. Government.

Disclaimer: While these are real data, the assignment is not an endorsement for any particular position on medical affairs or building hospitals. It is for instructional use only.

## 1. Mental Health Clinics

#### Part A

This data set is a survey of every known healthcare facility that offers mental health services in the United States in 2015. Navigate to [https://datafiles.samhsa.gov/study-dataset/national-mental-health-services-survey-2015-n-mhss-2015-ds0001-nid17098](https://datafiles.samhsa.gov/study-dataset/national-mental-health-services-survey-2015-n-mhss-2015-ds0001-nid17098and) select the R download. Look through the codebook PDF for an explanation on certain variables. Upon opening the RDA file, the data set should be inserted into your global environment, which you can then reference.


#### Part B

Please create code which lists the State abbreviations without their counts, one abbreviation per State value. It does not have to in data frame format. A vector is fine.

```{r 1b, echo=TRUE}

unique(mh2015_puf$LST)
```

#### Part C

Filter the data.frame from 1A. We are only interested in the Veterans Administration (VA) medical centers in the mainland United States-create a listing of counts of these centers by state, including only mainland locations. Alaska, Hawaii, and U.S. territories should be omitted. DC, while not a state, is in the mainland, so it should remain included. Convert this to data.frame()

```{r 1bc, echo=TRUE}

library(rvest)

harrypotter <- read_html("http://www.imdb.com/title/tt1201607/fullcredits?ref_=tt_ql_1")

cast <- (harrypotter %>%
  html_nodes("#fullcredits_content .itemprop span") %>%
  html_text())

character <- (harrypotter %>%
                 html_nodes("#fullcredits_content .character div") %>%
                 html_text() %>%
              gsub("^\\s+|\\s+$", "", .) %>%
              gsub("\n", "", .) %>%
              gsub("\\s+", " ", .)
              )

hp <- data.frame(cast, character)
names(hp) <- c("Actor", "Character")
```

#### Part D

Split the Actor's name into two columns: FirstName and Surname. Keep in mind that some actors/actresses have middle names as well. Please make sure that the middle names are in the FirstName column, in addition to the first name (example: given the Actor Frank Jeffrey Stevenson, the FirstName column would say "Frank Jeffrey.")

```{r 1d, echo=TRUE}

library(tidyr)
hp <- extract(hp, Actor, c("FirstName", "Surname"), "(.*)\\s(.*)")
```

#### Part E

Present the first 10 rows of the data.frame() - It should have only FirstName, Surname, and Character columns.
```{r 1e, echo=TRUE}

head(hp, n=10)
```

## 2. SportsBall

#### Part A

On the ESPN website, there are statistics of each NBA player. Navigate to the San Antonio Spurs current statistics (likely [http://www.espn.com/nba/team/stats/_/name/sa/san-antonio-spurs](http://www.espn.com/nba/team/stats/_/name/sa/san-antonio-spurs)). You are interested in the **Shooting Statistics** table.

#### Part B
Scrape the page with an R package that makes things easy for you. There are a few tables on the page, so make sure you are targeting specifically the Shooting Statistics table. 

#### Part C
Clean up the table (You might get some warnings if you're working with tibbles)

* You'll want to create an R data.frame() with one observation for each player. Make sure that you do not accidentally include blank rows, a row of column names, or the Totals row in the table as observations.

* The column PLAYER has two variables of interest in it: the player's name and their position, denoted by 1-2 letters after their name. Split the cells into two columns, one with Name and the other Position.

* Check the data type of all columns. Convert relevant columns to numeric. Check the data type of all columns again to confirm that they have changed!

```{r 2abc, echo=TRUE}
spurs <- read_html("http://www.espn.com/nba/team/stats/_/name/sa/san-antonio-spurs")

spurs <-
(spurs %>%
  html_nodes("#my-players-table div td") %>%
  html_text())
spurs <- spurs[287:572] # Shooting Stats table only
colnames <- spurs[1:16] # extract column names
colnames <- colnames[2:16] #remove ShootingStats text

spurs <- spurs[17:286] #delete column names from vector
newlength <- length(spurs)-15
spurs <- spurs [1:newlength]
spursm <- matrix(spurs, nrow=length(spurs)/15, byrow = TRUE) #create matrix from spurs vector

spursdf <- data.frame(spursm) #create data frame from spurs matrix
colnames(spursdf) <- colnames #assign colnames to spurs data frame

spursdf <- extract(spursdf, PLAYER, c("Name", "Position"), "(.*)\\,(.*)") # split player column into Name/Position
str(spursdf)

## begin converting columns to numeric ##
spursdf$FGM <- as.numeric(levels(spursdf$FGM))[spursdf$FGM]
spursdf$FGA <- as.numeric(levels(spursdf$FGA))[spursdf$FGA]
spursdf$`FG%` <- as.numeric(levels(spursdf$`FG%`))[spursdf$`FG%`]
spursdf$`3PM` <- as.numeric(levels(spursdf$`3PM`))[spursdf$`3PM`]
spursdf$`3PA` <- as.numeric(levels(spursdf$`3PA`))[spursdf$`3PA`]
spursdf$`3P%` <- as.numeric(levels(spursdf$`3P%`))[spursdf$`3P%`]
spursdf$FTM <- as.numeric(levels(spursdf$FTM))[spursdf$FTM]
spursdf$FTA <- as.numeric(levels(spursdf$FTA))[spursdf$FTA]
spursdf$`FT%` <- as.numeric(levels(spursdf$`FT%`))[spursdf$`FT%`]
spursdf$`2PM` <- as.numeric(levels(spursdf$`2PM`))[spursdf$`2PM`]
spursdf$`2PA` <- as.numeric(levels(spursdf$`2PA`))[spursdf$`2PA`]
spursdf$`2P%` <- as.numeric(levels(spursdf$`2P%`))[spursdf$`2P%`]
spursdf$PPS <- as.numeric(levels(spursdf$PPS))[spursdf$PPS]
spursdf$`AFG%` <- as.numeric(levels(spursdf$`AFG%`))[spursdf$`AFG%`]

#check data type of all columns
str(spursdf)
```

#### Part D
Create a colorful bar chart that shows the *Field Goals Percentage Per Game* for each person. It will be graded on the following criteria:

* Informative title, centered
* Relevant x and y axis labels (not simply variables names!)
* Human-readable axes with no overlap (you might have to flip x and y to fix that). **Note**: You do not have to convert the decimal to a percentage
* Color the columns by the team member's position (so, all PF's should have the same color, etc.)

```{r 2d, echo=TRUE}

# convert Position to factor
spursdf$Position <- as.factor(spursdf$Position)

# order by FG%
spursdf <- spursdf[order(spursdf$`FG%`),]

library(ggplot2)
p<-ggplot(data=spursdf, aes(x=reorder(Name, `FG%`), y=`FG%`))+geom_bar(aes(fill=Position), stat="identity") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip() 
p + labs(title = "Field Goals Percentage Per Game by Each Player", x = "Player", y = "Field Goal % Per Game")
```